language: node_js
node_js: 
  - "8.0.0"
services:
  - docker
before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.7.0
  - export PATH=$HOME/.yarn/bin:$PATH
  - git config --local user.name "etaletai13"
  - git config --local user.email "parker.casey@gmail.com"
  - git remote add upstream https://etaletai13:$GH_TOKEN@github.com/etaletai13/gmc
  - git fetch --unshallow upstream
after_success:
  - git add bin/*
  - git branch -d latest
  - git commit -am "build $TRAVIS_BUILD_NUMBER"
  - git push upstream latest -fq
before_deploy:
  - git tag -d $(git tag)
  - git tag "$(date +'%Y%m%d%H')-$(git log --format=%h -1)"
  - git push upstream latest -fq
deploy:
  provider: releases
  api_key: ${GH_TOKEN}
  file: "**/*"
  skip_cleanup: true
  on:
    repo: etaletai13/gmc-bin
    branch: 
      - latest
